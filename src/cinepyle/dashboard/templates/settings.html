{% extends "base.html" %}
{% block content %}

{# â”€â”€ Intervals Card â”€â”€ #}
<div class="card p-6">
    <h2 class="text-lg font-semibold mb-1">ì•Œë¦¼ ì£¼ê¸° ì„¤ì •</h2>
    <p class="text-muted-foreground text-sm mb-4">ìƒì˜ ëª¨ë‹ˆí„° ë° ì‹ ì‘ ì˜í™” ì²´í¬ ì£¼ê¸°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</p>
    <form hx-post="/settings/intervals" hx-target="#intervals-feedback" hx-swap="innerHTML">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
            <div>
                <label class="block text-sm text-muted-foreground mb-1">ìƒì˜ ëª¨ë‹ˆí„° ì²´í¬ ì£¼ê¸° (ì´ˆ)</label>
                <input type="number" name="screen_check_interval" value="{{ screen_check_interval }}"
                       min="60" max="86400" step="60"
                       class="input-field rounded-md px-3 py-2 w-full text-sm">
                <p class="text-xs text-muted-foreground mt-1">ìµœì†Œ 60ì´ˆ, ìµœëŒ€ 86400ì´ˆ (24ì‹œê°„)</p>
            </div>
            <div>
                <label class="block text-sm text-muted-foreground mb-1">ì‹ ì‘ ì˜í™” ì²´í¬ ì£¼ê¸° (ì´ˆ)</label>
                <input type="number" name="new_movie_interval" value="{{ new_movie_interval }}"
                       min="60" max="86400" step="60"
                       class="input-field rounded-md px-3 py-2 w-full text-sm">
                <p class="text-xs text-muted-foreground mt-1">ìµœì†Œ 60ì´ˆ, ìµœëŒ€ 86400ì´ˆ (24ì‹œê°„)</p>
            </div>
        </div>
        <div class="flex items-center gap-3">
            <button type="submit" class="btn-primary px-4 py-2 rounded-md text-sm font-medium">
                ì €ì¥
            </button>
            <span class="htmx-indicator text-muted-foreground text-sm">ì €ì¥ ì¤‘...</span>
        </div>
        <div id="intervals-feedback" class="mt-3 text-sm"></div>
    </form>
</div>

{# â”€â”€ Screen Monitor Card â”€â”€ #}
<div class="card p-6">
    <h2 class="text-lg font-semibold mb-1">ìƒì˜ ëª¨ë‹ˆí„°</h2>
    <p class="text-muted-foreground text-sm mb-4">ì˜í™”ê´€ ë˜ëŠ” íŠ¹ì • ê´€(IMAX, 4DX, Dolby ë“±)ì„ ì„ íƒí•˜ë©´ ìƒˆ ì˜í™” ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤.</p>

    {# Search input #}
    <div class="mb-4 relative">
        <label class="block text-sm text-muted-foreground mb-1">ì˜í™”ê´€ ê²€ìƒ‰</label>
        <input type="text" id="monitor-search-input"
               placeholder="ê·¹ì¥ëª… ê²€ìƒ‰ (ì˜ˆ: ìš©ì‚°, ì½”ì—‘ìŠ¤, ê±´ëŒ€)"
               hx-get="/api/theaters/search?context=monitor"
               hx-trigger="keyup changed delay:300ms"
               hx-target="#monitor-search-results"
               hx-swap="innerHTML"
               name="q"
               class="input-field rounded-md px-3 py-2 w-full text-sm"
               autocomplete="off">
        <div id="monitor-search-results" class="mt-1"></div>
    </div>

    {# Screen select area (shown when "ê´€ ì„ íƒ" is clicked) #}
    <div id="screen-select-area" class="mb-4" style="display:none">
        <div class="border border-orange-600/50 rounded-md p-4 bg-orange-950/10">
            <div class="flex items-center justify-between mb-3">
                <span class="text-sm font-medium" id="screen-select-title">ê´€ ì„ íƒ</span>
                <button type="button" onclick="closeScreenSelect()"
                        class="text-muted-foreground hover:text-foreground text-xs transition-colors">ë‹«ê¸°</button>
            </div>
            <div id="screen-select-loading" class="text-sm text-muted-foreground">ê´€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            <div id="screen-select-list" class="grid grid-cols-2 sm:grid-cols-3 gap-2" style="display:none"></div>
            <div id="screen-select-empty" class="text-sm text-muted-foreground" style="display:none">ê´€ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
            <button type="button" id="screen-select-add-btn" onclick="addSelectedScreens()"
                    class="mt-3 text-xs px-3 py-1.5 rounded border border-orange-600 text-orange-400 hover:bg-orange-900/30 transition-colors"
                    style="display:none">
                ì„ íƒí•œ ê´€ ì¶”ê°€
            </button>
        </div>
    </div>

    {# Monitor list #}
    <div class="mb-4">
        <label class="block text-sm text-muted-foreground mb-1">ëª¨ë‹ˆí„°ë§ ëª©ë¡</label>
        <div id="monitor-list" class="space-y-1">
            {% for m in screen_monitors %}
            <div class="flex items-center justify-between px-3 py-2 rounded-md border border-border bg-background"
                 data-chain="{{ m.chain_key }}" data-code="{{ m.theater_code }}"
                 data-name="{{ m.theater_name }}" data-filter="{{ m.screen_filter }}">
                <span class="text-sm flex items-center gap-2">
                    {% if m.screen_filter == 'all' %}
                    <span class="text-base">ğŸ¢</span>
                    {% else %}
                    <span class="text-base">ğŸ¥</span>
                    {% endif %}
                    <span class="text-xs text-muted-foreground">{{ chain_display.get(m.chain_key, m.chain_key) }}</span>
                    <span>{{ m.theater_name }}</span>
                    {% if m.screen_filter != 'all' %}
                    <span class="text-xs px-1.5 py-0.5 rounded bg-orange-900/30 text-orange-400 border border-orange-600/30">{{ m.screen_filter }}</span>
                    {% else %}
                    <span class="text-xs text-muted-foreground">ì „ì²´</span>
                    {% endif %}
                </span>
                <button type="button" onclick="removeMonitor(this)"
                        class="text-muted-foreground hover:text-red-400 text-xs transition-colors">ì‚­ì œ</button>
            </div>
            {% endfor %}
        </div>
        <p id="monitor-empty" class="text-xs text-muted-foreground mt-1"
           {% if screen_monitors %}style="display:none"{% endif %}>
            ë“±ë¡ëœ ëª¨ë‹ˆí„°ê°€ ì—†ìŠµë‹ˆë‹¤.
        </p>
    </div>

    {# Hidden form for saving #}
    <form id="monitor-form" hx-post="/settings/screen-monitors" hx-target="#monitor-feedback" hx-swap="innerHTML">
        <input type="hidden" name="screen_monitors_json" id="screen-monitors-json" value="">
        <div class="flex items-center gap-3">
            <button type="submit" class="btn-primary px-4 py-2 rounded-md text-sm font-medium">ì €ì¥</button>
            <span class="htmx-indicator text-muted-foreground text-sm">ì €ì¥ ì¤‘...</span>
        </div>
        <div id="monitor-feedback" class="mt-3 text-sm"></div>
    </form>
</div>

{# â”€â”€ Preferred Theaters Card â”€â”€ #}
<div class="card p-6">
    <h2 class="text-lg font-semibold mb-1">ì„ í˜¸ ì˜í™”ê´€</h2>
    <p class="text-muted-foreground text-sm mb-4">ì˜ˆë§¤ ì‹œ ìš°ì„  ì¶”ì²œí•  ì˜í™”ê´€ì„ ë“±ë¡í•©ë‹ˆë‹¤. (CGV, ë¡¯ë°ì‹œë„¤ë§ˆ, ë©”ê°€ë°•ìŠ¤, ì”¨ë„¤Q)</p>

    {# Search input #}
    <div class="mb-4 relative">
        <label class="block text-sm text-muted-foreground mb-1">ì˜í™”ê´€ ê²€ìƒ‰</label>
        <input type="text" id="theater-search-input"
               placeholder="ê·¹ì¥ëª… ê²€ìƒ‰ (ì˜ˆ: ìš©ì‚°, ì½”ì—‘ìŠ¤, ê±´ëŒ€)"
               hx-get="/api/theaters/search?context=preferred"
               hx-trigger="keyup changed delay:300ms"
               hx-target="#theater-search-results"
               hx-swap="innerHTML"
               name="q"
               class="input-field rounded-md px-3 py-2 w-full text-sm"
               autocomplete="off">
        <div id="theater-search-results" class="mt-1"></div>
    </div>

    {# Selected theaters list #}
    <div class="mb-4">
        <label class="block text-sm text-muted-foreground mb-1">ë“±ë¡ëœ ì˜í™”ê´€</label>
        <div id="preferred-theaters-list" class="space-y-1">
            {% for t in preferred_theaters %}
            <div class="flex items-center justify-between px-3 py-2 rounded-md border border-border bg-background"
                 data-chain="{{ t.chain_key }}" data-code="{{ t.theater_code }}"
                 data-region="{{ t.region_code }}" data-name="{{ t.name }}">
                <span class="text-sm">
                    <span class="text-xs text-muted-foreground mr-1">
                        {% if t.chain_key == 'cgv' %}CGV{% elif t.chain_key == 'lotte' %}ë¡¯ë°{% elif t.chain_key == 'megabox' %}ë©”ê°€ë°•ìŠ¤{% elif t.chain_key == 'cineq' %}ì”¨ë„¤Q{% elif t.chain_key == 'indie' %}ë…ë¦½{% endif %}
                    </span>
                    {{ t.name }}
                </span>
                <button type="button" onclick="removePreferredTheater(this)"
                        class="text-muted-foreground hover:text-red-400 text-xs transition-colors">ì‚­ì œ</button>
            </div>
            {% endfor %}
        </div>
        <p id="preferred-empty" class="text-xs text-muted-foreground mt-1"
           {% if preferred_theaters %}style="display:none"{% endif %}>
            ë“±ë¡ëœ ì˜í™”ê´€ì´ ì—†ìŠµë‹ˆë‹¤.
        </p>
    </div>

    {# Hidden form for saving #}
    <form id="preferred-theaters-form" hx-post="/settings/preferred-theaters" hx-target="#preferred-feedback" hx-swap="innerHTML">
        <input type="hidden" name="preferred_theaters_json" id="preferred-theaters-json" value="">
        <div class="flex items-center gap-3">
            <button type="submit" class="btn-primary px-4 py-2 rounded-md text-sm font-medium">ì €ì¥</button>
            <span class="htmx-indicator text-muted-foreground text-sm">ì €ì¥ ì¤‘...</span>
        </div>
        <div id="preferred-feedback" class="mt-3 text-sm"></div>
    </form>
</div>

<script>
/* â”€â”€ Screen Monitor â”€â”€ */
const chainLabels = {cgv: 'CGV', lotte: 'ë¡¯ë°', megabox: 'ë©”ê°€ë°•ìŠ¤', cineq: 'ì”¨ë„¤Q', indie: 'ë…ë¦½'};
let _screenSelectCtx = {};  // {chainKey, theaterCode, theaterName}

function addMonitor(chainKey, theaterCode, theaterName, screenFilter) {
    const list = document.getElementById('monitor-list');
    // Dedup: same theater + same filter
    for (const el of list.children) {
        if (el.dataset.chain === chainKey && el.dataset.code === theaterCode && el.dataset.filter === screenFilter) return;
    }

    const div = document.createElement('div');
    div.className = 'flex items-center justify-between px-3 py-2 rounded-md border border-border bg-background';
    div.dataset.chain = chainKey;
    div.dataset.code = theaterCode;
    div.dataset.name = theaterName;
    div.dataset.filter = screenFilter;

    const emoji = screenFilter === 'all' ? 'ğŸ¢' : 'ğŸ¥';
    const filterBadge = screenFilter === 'all'
        ? '<span class="text-xs text-muted-foreground">ì „ì²´</span>'
        : '<span class="text-xs px-1.5 py-0.5 rounded bg-orange-900/30 text-orange-400 border border-orange-600/30">' + screenFilter + '</span>';

    div.innerHTML = '<span class="text-sm flex items-center gap-2">' +
        '<span class="text-base">' + emoji + '</span>' +
        '<span class="text-xs text-muted-foreground">' + (chainLabels[chainKey] || chainKey) + '</span>' +
        '<span>' + theaterName + '</span>' +
        filterBadge +
        '</span>' +
        '<button type="button" onclick="removeMonitor(this)" ' +
        'class="text-muted-foreground hover:text-red-400 text-xs transition-colors">ì‚­ì œ</button>';
    list.appendChild(div);
    document.getElementById('monitor-empty').style.display = 'none';

    // Clear search
    document.getElementById('monitor-search-input').value = '';
    document.getElementById('monitor-search-results').innerHTML = '';
    closeScreenSelect();
}

function removeMonitor(btn) {
    btn.parentElement.remove();
    const list = document.getElementById('monitor-list');
    if (!list.children.length) {
        document.getElementById('monitor-empty').style.display = '';
    }
}

function loadScreenSelect(chainKey, theaterCode, theaterName) {
    _screenSelectCtx = {chainKey, theaterCode, theaterName};
    const area = document.getElementById('screen-select-area');
    area.style.display = '';
    document.getElementById('screen-select-title').textContent = theaterName + ' â€” ê´€ ì„ íƒ';
    document.getElementById('screen-select-loading').style.display = '';
    document.getElementById('screen-select-list').style.display = 'none';
    document.getElementById('screen-select-list').innerHTML = '';
    document.getElementById('screen-select-empty').style.display = 'none';
    document.getElementById('screen-select-add-btn').style.display = 'none';

    fetch('/api/theaters/' + chainKey + '/' + theaterCode + '/screens')
        .then(r => r.json())
        .then(data => {
            document.getElementById('screen-select-loading').style.display = 'none';
            const screens = data.screens || [];
            if (screens.length === 0) {
                document.getElementById('screen-select-empty').style.display = '';
                return;
            }
            const listEl = document.getElementById('screen-select-list');
            listEl.style.display = '';
            screens.forEach(name => {
                const label = document.createElement('label');
                label.className = 'flex items-center gap-2 px-3 py-2 rounded-md border border-border bg-background cursor-pointer hover:bg-zinc-800/50 transition-colors text-sm';
                label.innerHTML = '<input type="checkbox" value="' + name + '" class="rounded border-border accent-orange-500 screen-cb">' +
                    '<span>' + name + '</span>';
                listEl.appendChild(label);
            });
            document.getElementById('screen-select-add-btn').style.display = '';
        })
        .catch(() => {
            document.getElementById('screen-select-loading').style.display = 'none';
            document.getElementById('screen-select-empty').style.display = '';
        });
}

function closeScreenSelect() {
    document.getElementById('screen-select-area').style.display = 'none';
    _screenSelectCtx = {};
}

function addSelectedScreens() {
    const checkboxes = document.querySelectorAll('#screen-select-list .screen-cb:checked');
    if (!checkboxes.length || !_screenSelectCtx.chainKey) return;
    checkboxes.forEach(cb => {
        addMonitor(_screenSelectCtx.chainKey, _screenSelectCtx.theaterCode, _screenSelectCtx.theaterName, cb.value);
    });
    closeScreenSelect();
}

function syncMonitorJson() {
    const items = document.querySelectorAll('#monitor-list > div');
    const arr = Array.from(items).map(el => ({
        chain_key: el.dataset.chain,
        theater_code: el.dataset.code,
        theater_name: el.dataset.name,
        screen_filter: el.dataset.filter,
    }));
    document.getElementById('screen-monitors-json').value = JSON.stringify(arr);
}

document.getElementById('monitor-form').addEventListener('htmx:configRequest', function() {
    syncMonitorJson();
});

/* â”€â”€ Preferred Theaters â”€â”€ */
function addPreferredTheater(chainKey, code, region, name) {
    const list = document.getElementById('preferred-theaters-list');
    if (list.querySelector('[data-chain="' + chainKey + '"][data-code="' + code + '"]')) return;

    const div = document.createElement('div');
    div.className = 'flex items-center justify-between px-3 py-2 rounded-md border border-border bg-background';
    div.dataset.chain = chainKey;
    div.dataset.code = code;
    div.dataset.region = region || '';
    div.dataset.name = name;
    div.innerHTML = '<span class="text-sm"><span class="text-xs text-muted-foreground mr-1">' +
        (chainLabels[chainKey] || chainKey) + '</span>' + name + '</span>' +
        '<button type="button" onclick="removePreferredTheater(this)" ' +
        'class="text-muted-foreground hover:text-red-400 text-xs transition-colors">ì‚­ì œ</button>';
    list.appendChild(div);
    document.getElementById('preferred-empty').style.display = 'none';

    document.getElementById('theater-search-input').value = '';
    document.getElementById('theater-search-results').innerHTML = '';
}

function removePreferredTheater(btn) {
    btn.parentElement.remove();
    const list = document.getElementById('preferred-theaters-list');
    if (!list.children.length) {
        document.getElementById('preferred-empty').style.display = '';
    }
}

function syncPreferredJson() {
    const items = document.querySelectorAll('#preferred-theaters-list > div');
    const arr = Array.from(items).map(el => ({
        chain_key: el.dataset.chain,
        theater_code: el.dataset.code,
        region_code: el.dataset.region,
        name: el.dataset.name,
    }));
    document.getElementById('preferred-theaters-json').value = JSON.stringify(arr);
}

document.getElementById('preferred-theaters-form').addEventListener('htmx:configRequest', function() {
    syncPreferredJson();
});
</script>

{# â”€â”€ LLM Priority Card â”€â”€ #}
<div class="card p-6">
    <h2 class="text-lg font-semibold mb-1">LLM ìš°ì„ ìˆœìœ„</h2>
    <p class="text-muted-foreground text-sm mb-4">ìê°€ ë³µêµ¬ ë° ì˜ˆë§¤ ì—ì´ì „íŠ¸ì—ì„œ ì‚¬ìš©í•  LLM ì œê³µì ìš°ì„ ìˆœìœ„ë¥¼ ë“œë˜ê·¸ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</p>
    <form hx-post="/settings/llm-priority" hx-target="#llm-feedback" hx-swap="innerHTML">
        <div id="llm-sortable" class="space-y-2 mb-4">
            {% if llm_priority %}
            {% for provider in llm_priority %}
            <div class="flex items-center gap-3 px-4 py-3 rounded-md border border-border bg-background cursor-move"
                 data-provider="{{ provider }}">
                <span class="text-muted-foreground">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/></svg>
                </span>
                <span class="font-mono text-sm">{{ loop.index }}.</span>
                {% if provider == "anthropic" %}
                <span>Anthropic <span class="text-muted-foreground">(Claude)</span></span>
                {% elif provider == "openai" %}
                <span>OpenAI <span class="text-muted-foreground">(GPT)</span></span>
                {% elif provider == "gemini" %}
                <span>Google <span class="text-muted-foreground">(Gemini)</span></span>
                {% endif %}
                <input type="hidden" name="priority" value="{{ provider }}">
            </div>
            {% endfor %}
            {% else %}
            <p class="text-sm text-muted-foreground py-3">API í‚¤ê°€ ì„¤ì •ëœ LLMì´ ì—†ìŠµë‹ˆë‹¤. ì•„ë˜ í¬ë¦¬ë´ì…œì—ì„œ API í‚¤ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.</p>
            {% endif %}
        </div>
        <div class="flex items-center gap-3">
            <button type="submit" class="btn-primary px-4 py-2 rounded-md text-sm font-medium">
                ì €ì¥
            </button>
            <span class="htmx-indicator text-muted-foreground text-sm">ì €ì¥ ì¤‘...</span>
        </div>
        <div id="llm-feedback" class="mt-3 text-sm"></div>
    </form>
    <script>
        new Sortable(document.getElementById('llm-sortable'), {
            animation: 150,
            ghostClass: 'sortable-ghost',
            chosenClass: 'sortable-chosen',
            onEnd: function () {
                // Update hidden input values and visible numbers after drag
                const items = document.querySelectorAll('#llm-sortable > div');
                items.forEach((item, i) => {
                    item.querySelector('.font-mono').textContent = (i + 1) + '.';
                });
            }
        });
    </script>
</div>

{# â”€â”€ Credentials Card â”€â”€ #}
<div class="card p-6">
    <h2 class="text-lg font-semibold mb-1">í¬ë¦¬ë´ì…œ / API í‚¤</h2>
    <p class="text-muted-foreground text-sm mb-4">ë¹ˆ ì¹¸ì€ ê¸°ì¡´ ê°’ì„ ìœ ì§€í•©ë‹ˆë‹¤. ìƒˆ ê°’ì„ ì…ë ¥í•˜ë©´ ë®ì–´ì”ë‹ˆë‹¤.</p>
    <form hx-post="/settings/credentials" hx-target="#credentials-feedback" hx-swap="innerHTML">

        {# Telegram #}
        <h3 class="text-sm font-medium text-muted-foreground mb-3 mt-2">Telegram</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-5">
            <div>
                <label class="block text-xs text-muted-foreground mb-1">Bot Token</label>
                {% if env_creds['credential:telegram_bot_token'] %}
                <input type="text" disabled value="í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •ë¨"
                       class="input-field rounded-md px-3 py-2 w-full text-sm font-mono opacity-20 cursor-not-allowed">
                {% else %}
                <input type="password" name="credential:telegram_bot_token"
                       placeholder="{% if creds['credential:telegram_bot_token'] %}******{% else %}ë¯¸ì„¤ì •{% endif %}"
                       class="input-field rounded-md px-3 py-2 w-full text-sm font-mono" autocomplete="off">
                {% endif %}
            </div>
            <div>
                <label class="block text-xs text-muted-foreground mb-1">Chat ID</label>
                {% if env_creds['credential:telegram_chat_id'] %}
                <input type="text" disabled value="í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •ë¨"
                       class="input-field rounded-md px-3 py-2 w-full text-sm font-mono opacity-20 cursor-not-allowed">
                {% else %}
                <input type="text" name="credential:telegram_chat_id"
                       placeholder="{% if creds['credential:telegram_chat_id'] %}******{% else %}ë¯¸ì„¤ì •{% endif %}"
                       class="input-field rounded-md px-3 py-2 w-full text-sm font-mono" autocomplete="off">
                {% endif %}
            </div>
        </div>

        {# Theater logins #}
        <h3 class="text-sm font-medium text-muted-foreground mb-3 mt-2">ì˜í™”ê´€ ë¡œê·¸ì¸</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-5">
            {% for chain, label in [("cgv", "CGV"), ("lottecinema", "ë¡¯ë°ì‹œë„¤ë§ˆ"), ("megabox", "ë©”ê°€ë°•ìŠ¤"), ("cineq", "CineQ")] %}
            {% set id_key = 'credential:' ~ chain ~ '_id' %}
            {% set pw_key = 'credential:' ~ chain ~ '_password' %}
            <div>
                <label class="block text-xs text-muted-foreground mb-1">{{ label }} ID</label>
                {% if env_creds[id_key] %}
                <input type="text" disabled value="í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •ë¨"
                       class="input-field rounded-md px-3 py-2 w-full text-sm opacity-20 cursor-not-allowed">
                {% else %}
                <input type="text" name="{{ id_key }}"
                       placeholder="{% if creds[id_key] %}******{% else %}ë¯¸ì„¤ì •{% endif %}"
                       class="input-field rounded-md px-3 py-2 w-full text-sm" autocomplete="off">
                {% endif %}
            </div>
            <div>
                <label class="block text-xs text-muted-foreground mb-1">{{ label }} ë¹„ë°€ë²ˆí˜¸</label>
                {% if env_creds[pw_key] %}
                <input type="text" disabled value="í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •ë¨"
                       class="input-field rounded-md px-3 py-2 w-full text-sm opacity-20 cursor-not-allowed">
                {% else %}
                <input type="password" name="{{ pw_key }}"
                       placeholder="{% if creds[pw_key] %}******{% else %}ë¯¸ì„¤ì •{% endif %}"
                       class="input-field rounded-md px-3 py-2 w-full text-sm" autocomplete="off">
                {% endif %}
            </div>
            {% endfor %}
        </div>

        {# API Keys #}
        <h3 class="text-sm font-medium text-muted-foreground mb-3">API í‚¤</h3>
        <div class="grid grid-cols-1 gap-3 mb-5">
            {% for key, label in [("anthropic_api_key", "Anthropic API Key"), ("openai_api_key", "OpenAI API Key"), ("gemini_api_key", "Gemini API Key"), ("kofic_api_key", "KOFIC (ì˜ì§„ìœ„) API Key")] %}
            {% set cred_key = 'credential:' ~ key %}
            <div>
                <label class="block text-xs text-muted-foreground mb-1">{{ label }}</label>
                {% if env_creds[cred_key] %}
                <input type="text" disabled value="í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •ë¨"
                       class="input-field rounded-md px-3 py-2 w-full text-sm font-mono opacity-20 cursor-not-allowed">
                {% else %}
                <input type="password" name="{{ cred_key }}"
                       placeholder="{% if creds[cred_key] %}******{% else %}ë¯¸ì„¤ì •{% endif %}"
                       class="input-field rounded-md px-3 py-2 w-full text-sm font-mono" autocomplete="off">
                {% endif %}
            </div>
            {% endfor %}
        </div>

        {# Watcha #}
        <h3 class="text-sm font-medium text-muted-foreground mb-3">Watcha Pedia</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-5">
            <div>
                <label class="block text-xs text-muted-foreground mb-1">Watcha ì´ë©”ì¼</label>
                {% if env_creds['credential:watcha_email'] %}
                <input type="text" disabled value="í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •ë¨"
                       class="input-field rounded-md px-3 py-2 w-full text-sm opacity-20 cursor-not-allowed">
                {% else %}
                <input type="text" name="credential:watcha_email"
                       placeholder="{% if creds['credential:watcha_email'] %}******{% else %}ë¯¸ì„¤ì •{% endif %}"
                       class="input-field rounded-md px-3 py-2 w-full text-sm" autocomplete="off">
                {% endif %}
            </div>
            <div>
                <label class="block text-xs text-muted-foreground mb-1">Watcha ë¹„ë°€ë²ˆí˜¸</label>
                {% if env_creds['credential:watcha_password'] %}
                <input type="text" disabled value="í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •ë¨"
                       class="input-field rounded-md px-3 py-2 w-full text-sm opacity-20 cursor-not-allowed">
                {% else %}
                <input type="password" name="credential:watcha_password"
                       placeholder="{% if creds['credential:watcha_password'] %}******{% else %}ë¯¸ì„¤ì •{% endif %}"
                       class="input-field rounded-md px-3 py-2 w-full text-sm" autocomplete="off">
                {% endif %}
            </div>
        </div>

        {# Naver Maps #}
        <h3 class="text-sm font-medium text-muted-foreground mb-3">ë„¤ì´ë²„ ì§€ë„ API</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-5">
            <div>
                <label class="block text-xs text-muted-foreground mb-1">Client ID</label>
                {% if env_creds['credential:naver_maps_client_id'] %}
                <input type="text" disabled value="í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •ë¨"
                       class="input-field rounded-md px-3 py-2 w-full text-sm font-mono opacity-20 cursor-not-allowed">
                {% else %}
                <input type="password" name="credential:naver_maps_client_id"
                       placeholder="{% if creds['credential:naver_maps_client_id'] %}******{% else %}ë¯¸ì„¤ì •{% endif %}"
                       class="input-field rounded-md px-3 py-2 w-full text-sm font-mono" autocomplete="off">
                {% endif %}
            </div>
            <div>
                <label class="block text-xs text-muted-foreground mb-1">Client Secret</label>
                {% if env_creds['credential:naver_maps_client_secret'] %}
                <input type="text" disabled value="í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •ë¨"
                       class="input-field rounded-md px-3 py-2 w-full text-sm font-mono opacity-20 cursor-not-allowed">
                {% else %}
                <input type="password" name="credential:naver_maps_client_secret"
                       placeholder="{% if creds['credential:naver_maps_client_secret'] %}******{% else %}ë¯¸ì„¤ì •{% endif %}"
                       class="input-field rounded-md px-3 py-2 w-full text-sm font-mono" autocomplete="off">
                {% endif %}
            </div>
        </div>

        <div class="flex items-center gap-3">
            <button type="submit" class="btn-primary px-4 py-2 rounded-md text-sm font-medium">
                ì €ì¥
            </button>
            <span class="htmx-indicator text-muted-foreground text-sm">ì €ì¥ ì¤‘...</span>
        </div>
        <div id="credentials-feedback" class="mt-3 text-sm"></div>
    </form>
</div>

{% endblock %}
